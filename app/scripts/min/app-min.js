angular.module("blocJams",["ui.router"]).config(function(e,n,t){t.html5Mode({enabled:!0,requireBase:!1}),n.otherwise("/landing"),e.state("landing",{url:"/landing",controller:"Landing.controller",templateUrl:"/templates/landing.html"}).state("album",{url:"/album",controller:"Album.controller",templateUrl:"/templates/album.html"}).state("collection",{url:"/collection",controller:"Collection.controller",templateUrl:"/templates/collection.html"})}).controller("Landing.controller",function(e,n){e.landingTitle="Turn the music up!",n.bodyClass="landing";var t=document.getElementsByClassName("point"),l=function(){for(var e=0;3>e;e++)t[e].style.opacity=1,t[e].style.transform="scaleX(1) translateY(0)",t[e].style.msTransform="scaleX(1) translateY(0)",t[e].style.WebkitTransform="scaleX(1) translateY(0)"};l()}).controller("Album.controller",function(e,n,t){e.album=albumPicasso,t.setCurrentAlbum(albumPicasso),n.bodyClass="album",e.playingTrackIndex=t.currentSongIndex(),e.togglePlay=null===e.playingTrackIndex||t.isPaused(),e.volume=80,e.$watch("volume",function(){t.setVolume(e.volume)}),e.$watch("trackProgress",function(){void 0!==e.trackProgress&&Math.abs(t.getTime()/t.getDuration()*100-e.trackProgress)>1&&t.setTime(e.trackProgress/100*t.getDuration())}),window.skope=e,e.updateSeekBarWhileSongPlays=function(){e.trackProgress=t.getTime()/t.getDuration()*100,t.getTime()===t.getDuration()&&e.nextSong()},e.listener=function(){t.registerProgressListener(function(){e.$digest(),e.$apply(function(){e.updateTime(),e.updateDuration(),e.updateSeekBarWhileSongPlays()})})},e.listener(),e.updateDuration=function(){null!==e.playingTrackIndex&&(e.duration=t.getDuration())},e.updateTime=function(){null!==e.playingTrackIndex&&(e.time=t.getTime())},e.infoShow=function(){return null!==e.playingTrackIndex},e.togglePlayPause=function(){e.togglePlay=t.togglePlayFromPlayerBar(),null===e.playingTrackIndex&&(e.playingTrackIndex=0),(!e.togglePlay||e.togglePlay&&null===e.playingTrackIndex)&&e.listener()},e.enterHover=function(n){e.hoveredIndex=n},e.leaveHover=function(n){e.hoveredIndex=null},e.hideTrack=function(n){return e.hoveredIndex===n||e.playingTrackIndex===n},e.isPaused=function(){return t.isPaused()},e.pauseSong=function(n){t.pause(),e.playingTrackIndex=n,e.togglePlay=!0},e.playSong=function(n){e.playingTrackIndex!==n&&t.setSong(n+1),e.playingTrackIndex=n,t.play(),e.listener(),e.togglePlay=!1},e.nextSong=function(){t.nextSong(),e.playingTrackIndex++,e.playingTrackIndex>=e.album.songs.length&&(e.playingTrackIndex=0),e.listener(),e.togglePlay=!1},e.previousSong=function(){t.previousSong(),e.playingTrackIndex--,e.playingTrackIndex<0&&(e.playingTrackIndex=e.album.songs.length-1),e.listener(),e.togglePlay=!1},null!==e.playingTrackIndex&&(e.updateTime(),e.updateDuration(),e.updateSeekBarWhileSongPlays())}).controller("Collection.controller",function(e,n){e.albums=[albumPicasso],n.bodyClass="collection"}).factory("MusicPlayer",function(){var e=null,n=null,t=null,l=null,o=80,a=function(e,n){return e.songs.indexOf(n)};return{setCurrentAlbum:function(n){for(e=n,i=0;i<n.songs.length;i++){var t=new buzz.sound(n.songs[i].audioUrl,{formats:["mp3"],preload:"metadata"}),l=function(e,n){return function(){var e=n.getDuration()}};t.bind("loadedmetadata",l(i,t))}},setSong:function(a){l&&(l.stop(),l.unbind("timeupdate")),n=a,t=e.songs[a-1],l=new buzz.sound(t.audioUrl,{formats:["mp3"],preload:!0}),this.setVolume(o)},setVolume:function(e){o=e,l&&l.setVolume(e)},setTime:function(e){l&&l.setTime(e)},togglePlayFromPlayerBar:function(){if(null===n){return this.nextSong();return!1}return l.isPaused()?(l.play(),!1):l?(l.pause(),!0):void 0},isPaused:function(){return l.isPaused()},getTime:function(){return l.getTime()},registerProgressListener:function(e){null!==l&&l.bind("timeupdate",e)},getDuration:function(){return l.getDuration()},pause:function(){l.pause()},play:function(){l.play()},currentSongIndex:function(){return l?a(e,t):null},nextSong:function(){var n=a(e,t);n++,n>=e.songs.length&&(n=0),this.setSong(n+1),l.play()},previousSong:function(){var n=a(e,t);n--,0>n&&(n=e.songs.length-1),this.setSong(n+1),l.play()}}}).directive("mySlider",function(e,n){return{templateUrl:"templates/slider.html",restrict:"E",replace:!0,scope:{value:"="},link:function(e,t,l){function o(n){var l=n.pageX-(t[0].getBoundingClientRect().left+document.body.scrollLeft),o=t[0].offsetWidth,a=l/o;e.value=100*a,e.setBarLimits(),e.$apply()}function a(){n.unbind("mousemove",o),n.unbind("mouseup",a)}e.fillStyles={width:(e.value||0)+"%"},e.thumbStyles={left:e.fillStyles.width},e.$watch("value",function(){e.fillStyles={width:(e.value||0)+"%"},e.thumbStyles={left:e.fillStyles.width}}),e.setBarLimits=function(){e.value<=0?e.value=0:e.value>=100&&(e.value=100)},t.on("mousedown",function(l){if(void 0!==e.value){var r=l.pageX-(t[0].getBoundingClientRect().left+document.body.scrollLeft),i=t[0].offsetWidth,u=r/i;e.value=100*u,n.on("mousemove",o),n.on("mouseup",a),e.setBarLimits()}})}}}).filter("filterTime",function(){return function(e){var n=parseFloat(e);if(isNaN(n))return"0:00";var t=Math.floor(n/60),l=Math.floor(n-60*t);if(l>=10)var o=t+":"+l;else var o=t+":0"+l;return o}});